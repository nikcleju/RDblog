<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-01-16">
<meta name="description" content="A review of papers showing how to use VAEs for unsupervised anomaly detection">

<title>My Notes - Unsupervised Anomaly Detection with Variational Autoencoders</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Notes</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Unsupervised Anomaly Detection with Variational Autoencoders</h1>
                  <div>
        <div class="description">
          A review of papers showing how to use VAEs for unsupervised anomaly detection
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">paper</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 16, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#review-papers" id="toc-review-papers" class="nav-link active" data-scroll-target="#review-papers">Review papers</a>
  <ul class="collapse">
  <li><a href="#an2015" id="toc-an2015" class="nav-link" data-scroll-target="#an2015">An2015</a></li>
  <li><a href="#wievel2019" id="toc-wievel2019" class="nav-link" data-scroll-target="#wievel2019">Wievel2019</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="review-papers" class="level2">
<h2 class="anchored" data-anchor-id="review-papers">Review papers</h2>
<section id="an2015" class="level3">
<h3 class="anchored" data-anchor-id="an2015">An2015</h3>
<p><strong>Variational Autoencoder based Anomaly Detection using Reconstruction Probability</strong></p>
<blockquote class="blockquote">
<p>InProceedings (An2015)<br>
An, J. &amp; Cho, S.<br>
Variational Autoencoder based Anomaly Detection using Reconstruction Probability<br>
2015</p>
</blockquote>
<p><img src="img/2023-01-16-17-17-52.png" class="img-fluid"></p>
<p>The algorithm:</p>
<ul>
<li><p>VAEs learn a distribution of the inputs</p></li>
<li><p>The latent distribution <span class="math inline">\(p(z)\)</span> acts as a prior (in Bayesian terms), and is the multivariate standard normal and isotropic (i.e.&nbsp;separable, covariance matrix is diagonal)</p></li>
<li><p><span class="math inline">\(f(x)\)</span> is the encoder function</p></li>
<li><p><span class="math inline">\(g(z)\)</span> is the decoder function</p></li>
<li><p>The decoder function <span class="math inline">\(g(z)\)</span> maps the distribution of the latent variable <span class="math inline">\(z\)</span> into an output distribution <span class="math inline">\(p(x|z)\)</span> which should resemble the original distribution of <span class="math inline">\(x\)</span></p></li>
<li><p>During reconstruction, when we sample a single latent variable <span class="math inline">\(z\)</span>, we reconstruct a single vector <span class="math inline">\(\hat{x}\)</span>, so we have a single sample of the output distribution <span class="math inline">\(p(x|z)\)</span></p></li>
<li><p>Idea for using Reconstruction Probability as an anomaly measure:</p>
<ul>
<li><p>sample multiple latent variables <span class="math inline">\(z^k\)</span>, and for each of them reconstruct the vector <span class="math inline">\(\hat{x}^k\)</span></p></li>
<li><p>use all the vectors <span class="math inline">\(\hat{x}^k\)</span> to estimate the probability <span class="math inline">\(p(x|z)\)</span>, and then compute the likelihood that the original input <span class="math inline">\(x\)</span> comes from this distribution</p></li>
<li><p>assuming <span class="math inline">\(p(x|z)\)</span> is a an isotropic normal distribution, we just compute the mean <span class="math inline">\(\mu = E \lbrace \hat{x} \rbrace\)</span> and covariance matrix <span class="math inline">\(\Sigma\)</span> (diagonal, so basically we compute the variance <span class="math inline">\(\sigma_i^2\)</span> per entry of the vector)</p></li>
<li><p>the log-likelihood that the original <span class="math inline">\(x\)</span> is generated by this distribution amounts to a weighted <span class="math inline">\(\ell_2\)</span> norm:</p>
<p><span class="math display">\[L(x) = \sum_i \frac{(x_i - \mu_i)^2}{\sigma_i^2}\]</span></p></li>
<li><p>we use this as an anomaly score: small value = more anomaly, large value = more normal</p></li>
<li><p>small value =&gt; anomaly, because <span class="math inline">\(x\)</span> does not fit the output probability <span class="math inline">\(p(x|z)\)</span></p></li>
</ul></li>
<li><p>Better than normal AE, because the variances are taken into account</p></li>
<li><p>Perhaps the variances <span class="math inline">\(\sigma_i^2\)</span> can be used as indicators for feature selection?</p>
<ul>
<li>or are they just similar to the clones values based on the input variances</li>
</ul></li>
</ul>
</section>
<section id="wievel2019" class="level3">
<h3 class="anchored" data-anchor-id="wievel2019">Wievel2019</h3>
<p><strong>Continual Learning for Anomaly Detection with Variational Autoencoder</strong></p>
<blockquote class="blockquote">
<p>InProceedings (Wiewel2019)<br>
Wiewel, F. &amp; Yang, B.<br>
Continual Learning for Anomaly Detection with Variational Autoencoder<br>
ICASSP 2019 - 2019 IEEE International Conference on Acoustics, Speech and Signal Processing (ICASSP), 2019, 3837-3841</p>
</blockquote>
<ul>
<li><p>Use the full loss function as anomaly score, which includes the reconstruction error <strong>and</strong> the KL distance between the distribution of <span class="math inline">\(z\)</span> and the standard normal prior <span class="math inline">\(p(z)\)</span></p>
<ul>
<li><blockquote class="blockquote">
<p>the so called evidence lower bound (ELBO): <img src="img/2023-01-16-17-50-43.png" class="img-fluid"></p>
</blockquote></li>
<li><blockquote class="blockquote">
<p>While [4, 5, 6, 7] use the reconstruction probability E q φ (z|x i ) [ln p θ (x i |z)] as the anomaly score, we use the ELBO as the anomaly score because it gives slightly better results in our experiments.</p>
</blockquote></li>
</ul></li>
<li><p>The “reconstruction probability” used in An2015 is just the first part of the loss function (ELBO), why not use the full loss, since this is what the model was trained to minimize</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>